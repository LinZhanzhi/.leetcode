Certainly! Let's give a **detailed mathematical proof** why the first player in the Nim Game wins if and only if $n \not\equiv 0 \pmod{4}$.

# Problem Restatement

- There is a heap of $n$ stones.
- Two players alternate turns; the first player moves first.
- Each turn, the player must take between 1 and 3 stones.
- The player who takes the last stone **wins**.
- Both players play **optimally** (perfect strategy).

# Goal

Prove: 

$$
\text{First player has a winning strategy} \iff n \not\equiv 0 \pmod{4}
$$

# Step 1: Define **Winning** and **Losing** Positions

- A position with $n$ stones is **winning** if the player about to move can force a win regardless of the opponent's moves.
- A position is **losing** if the player about to move loses if the opponent plays optimally.

By convention,

- **Base Case:** $n=0$ is losing (no stones left to take).
- For $n > 0$, the position is winning if **there exists a move to a losing position.**

# Step 2: Analyze Small Values of $n$

- $n=0$: losing (no moves).
- $n=1$: player can remove 1 stone and win immediately $\Rightarrow$ winning.
- $n=2$: player can remove 2 stones and win immediately $\Rightarrow$ winning.
- $n=3$: player can remove 3 stones and win immediately $\Rightarrow$ winning.
- $n=4$: look at possible moves:

The moves take 1, 2, or 3 stones, leading to subproblems:

- Remove 1 stone $\to$ remaining $n=3$ (winning)
- Remove 2 stones $\to$ remaining $n=2$ (winning)
- Remove 3 stones $\to$ remaining $n=1$ (winning)

Since *all* transitions lead to winning positions for the opponent, $n=4$ is losing.

# Step 3: Recurrence for $n > 0$

For $n \geq 1$, let:

$$
W(n) = \begin{cases}
\text{true}, & \text{if player to move at } n \text{ can force a win}\\
\text{false}, & \text{otherwise}
\end{cases}
$$

We have:

$$
W(n) = \text{any of } W(n-1), W(n-2), W(n-3) \text{ is false}
$$

In words: the current position is winning if the player can move to a losing position.

Using the base cases:

- $W(0) = \text{false}$
- $W(1), W(2), W(3) = \text{true}$ due to immediate win.

We checked $W(4) = \text{false}$.

# Step 4: Compute a few more values

- $W(5) = \exists i \in \{1,2,3\} \text{ s.t. } W(5 - i) = \text{false}$?

Check:

- $W(4) = \text{false}$ (losing)
- $W(3) = \text{true}$
- $W(2) = \text{true}$

Since $W(4)$ is false, $W(5) = \text{true}.$

- Similarly,

$W(6) = \text{true}$ (because $W(5)$, $W(4)$, $W(3)$ includes $W(4)=\text{false}$).

- $W(7) = \text{true}$ (same reasoning).

- $W(8) = \exists i \text{ such that } W(8-i) = \text{false}$?

Check:

- $W(7)=\text{true}$
- $W(6)=\text{true}$
- $W(5)=\text{true}$

No losing position reachable $\Rightarrow W(8)=\text{false}$.

# Step 5: Pattern Recognition and Induction Hypothesis

So far, the sequence of $W(n)$ is:

$$
\begin{array}{c|c}
n & W(n) \\
\hline
0 & \text{false} \\
1 & \text{true} \\
2 & \text{true} \\
3 & \text{true} \\
4 & \text{false} \\
5 & \text{true} \\
6 & \text{true} \\
7 & \text{true} \\
8 & \text{false} \\
\vdots & \vdots
\end{array}
$$

Losing positions occur precisely when $n$ is divisible by 4.

# Step 6: Formal Proof by Induction

### Claim:

$$
W(n) = \text{false} \iff n \equiv 0 \pmod{4}
$$

### Base cases:
- $n=0$: $W(0) = \text{false}$ and $0 \equiv 0 \pmod{4}$ (holds).

### Inductive step:

Assume the claim holds for all $k<n$; show it for $n$.

### Case 1: $n \equiv 0 \pmod{4}$

Because:

- $W(n) = \exists i \in \{1,2,3\}$ s.t. $W(n-i) = \text{false}$ ? 

We want to see if the player can force the opponent into losing.

Since $n-1, n-2, n-3 \not\equiv 0 \pmod{4}$ (because subtracting 1,2,3 from multiple of 4 never results in multiple of 4):

- By induction, $W(n-1), W(n-2), W(n-3) = \text{true}$ (winning positions).

Thus,

$$
W(n) = \text{false}
$$

### Case 2: $n \not\equiv 0 \pmod{4}$

Then one of $n-1$, $n-2$, or $n-3$ will be congruent to 0 mod 4 because:

- Suppose $n \equiv r \pmod{4}$ with $r \in \{1,2,3\}$.
- Then:

$$
n - r \equiv 0 \pmod{4}
$$

Hence, there exists a move reducing the heap to a losing position for the opponent.

By induction, $W(n-r) = \text{false}$.

This means:

$$
W(n) = \text{true}
$$

# Step 7: Intuition of the Winning Strategy

- If $n \equiv 0 \pmod{4}$, the current player is in a losing position because no matter what move they make (removing 1 to 3 stones), they leave the opponent a *winning position*.
  
- If $n \not\equiv 0 \pmod{4}$, the current player can make a move reducing the heap size to a multiple of 4, therefore forcing the opponent into a losing position.

# Step 8: Summary of the proof

$$
\boxed{
\text{First player wins} \iff n \not\equiv 0 \pmod{4}
}
$$

# Optional: Explicit Strategy for First Player

- On first turn (when $n \not\equiv 0 \pmod{4}$), remove $r = n \bmod 4$ stones.
- Now the heap has $n - r$, which is divisible by 4.
- Afterwards, **mirror opponent's moves**, so the heap remains multiples of 4 after your turn.
- Eventually, the opponent is forced to take the last stone from a multiple-of-4 heap and lose.

# Time and Space Complexity

- The check $n \mod 4$ is done in $O(1)$ time.
- No extra space beyond constants is needed.

# Final Note on the Examples:

- For $n=4$ ($4 \mod 4 =0$), first player loses.
- For $n=1$, $2$, or $3$, first player immediately wins.
- For $n=5$, first player removes 1 stone making it 4 for the opponent (losing state for opponent).

--- 

# Summary

You have proven why the Nim game with moves of removing 1-3 stones has the simple condition:

$$
\boxed{
\text{First player wins} \iff n \mod 4 \neq 0
}
$$

This condition perfectly encapsulates the problem in a constant time check.

If you want, I can also provide the Python code for this solution!